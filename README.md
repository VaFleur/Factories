# Система управления фабрикой

## Описание проекта

Этот проект представляет собой REST API для управления справочниками фабрик, участков и оборудования. Система позволяет динамически создавать и управлять этими справочниками, а также указывать связи между ними.

### Возможности:
- Создание, обновление, удаление и поиск фабрик, участков и оборудования.
- Управление связями между фабриками, участками и оборудованием.
- Поиск объектов по ID с возможностью загрузки связанных сущностей на различных уровнях глубины.

## Порядок запуска проекта

### Запуск с помощью Docker

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/VaFleur/Factories.git
   cd Factories
   ```
2. Запустите контейнеры с помощью Docker Compose:
    ```dockerfile
   docker compose up --build
   ```
3. Примените миграции alembic
    ```dockerfile
   docker compose exec app alembic upgrade head
   ```
4. API будет доступен по адресу http://127.0.0.1:8000
5. Swagger документация будет доступна по адресу http://127.0.0.1:8000/docs

## Эндпоинты

### Фабрики

Создание фабрики
- Метод: POST
- URL: /factories
- Тело запроса:
    ```json
    [
      {
        "name": "Фабрика1",
        "departments": [
          {
            "name": "Участок1",
            "equipments": [
              { "name": "Оборудование1" },
              { "name": "Оборудование2" }
            ]
          },
          {
            "name": "Участок2",
            "equipments": [
              { "name": "Оборудование3" }
            ]
          }
        ]
      }
    ]
    ```
Эндпоинт позволяет создать одну или несколько структур Фабрика/Участок/Оборудование, где поля equipments и departments 
не обязательны к заполнению

Поиск фабрики по id
- Метод: GET
- URL: /factories/{factory_id}
- Параметры: depth (опционально): уровень глубины поиска по связанным сущностям, где 0 - поиск фабрики, 1 - поиск фабрики
и её участков, 2 - поиск фабрики, её участков и их оборудования
- Пример запроса:
    ```
  curl "http://127.0.0.1:8000/factories/1?depth=2"
  ```
Поиск фабрики по названию
- Метод: GET
- URL: /factories/search
- Параметры: search: подстрока для поиска по имени фабрики
- Пример запроса
    ```
  curl "http://127.0.0.1:8000/factories/search?search=Фабрика1"
  ```
Поиск всех фабрик
- Метод: GET
- URL: /factories
- Пример запроса:
    ```
    http://127.0.0.1:8000/factories
  ```
Обновление фабрики
- Метод: PUT
- URL: /factories/{factory_id}
- Тело запроса:
    ```json
  {
  "name": "Новое имя фабрики"
    }
  ```
Удаление фабрики
- Метод: DELETE
- URL: /factories/{factory_id}
- Пример запроса:
    ```
    curl -X DELETE "http://127.0.0.1:8000/factories/1"
  ```
### Участки

Создание участка
- Метод: POST
- URL: /departments
- Тело запроса:
    ```json
    [
      {
        "name": "Участок1",
        "factory_id": 1,
        "equipments": [
          { "name": "Оборудование1" },
          { "name": "Оборудование2" }
        ]
      },
      {
        "name": "Участок2"
      }
    ]
    ```
Эндпоинт позволяет создать одну или несколько структур Участок/Оборудование, где поля factory_id и equipments
не обязательны к заполнению

Поиск участка по id
- Метод: GET
- URL: /departments/{department_id}
- Параметры: depth (опционально): уровень глубины поиска по связанным сущностям, где 0 - поиск участка, 1 - поиск
 участка, его фабрик и оборудования
- Пример запроса:
    ```
  curl "http://127.0.0.1:8000/departments/1?depth=2"
  ```
Поиск участка по названию
- Метод: GET
- URL: /departments/search
- Параметры: search: подстрока для поиска по имени участка
- Пример запроса
    ```
  curl "http://127.0.0.1:8000/departments/search?search=Участок1"
  ```
Поиск всех участков
- Метод: GET
- URL: /departments
- Пример запроса:
    ```
    curl "http://127.0.0.1:8000/departments"
  ```
Обновление участка
- Метод: PUT
- URL: /departments/{department_id}
- Тело запроса:
    ```json
  {
  "name": "Новое имя участка",
  "factory_id": "1"
    }
  ```
Поля name и factory_id не обязательны к заполнению, что позволяет частично обновить запись

Удаление участка
- Метод: DELETE
- URL: /departments/{department_id}
- Пример запроса:
    ```
    curl -X DELETE "http://127.0.0.1:8000/departments/1"
  ```
### Оборудование

Создание оборудования
- Метод: POST
- URL: /equipment
- Тело запроса:
    ```json
    [
      {
        "name": "Оборудование1",
        "departments": [
          { "department_id": 1 },
          { "department_id": 2 }
        ]
      },
      {
        "name": "Оборудование2"
      }
    ]
    ```
Эндпоинт позволяет создать одну или несколько структур Оборудование/Участки, где поле departments
не обязательно к заполнению

Поиск оборудования по id
- Метод: GET
- URL: /equipments/{equipment_id}
- Параметры: depth (опционально): уровень глубины поиска по связанным сущностям, где 0 - поиск оборудования, 1 - поиск
 участка связанных участков, 2 - поиск оборудования, связанных участков и фабрики
- Пример запроса:
    ```
  curl "http://127.0.0.1:8000/equipments/1?depth=2"
  ```
Поиск оборудования по названию
- Метод: GET
- URL: /equipments/search
- Параметры: search: подстрока для поиска по имени участка
- Пример запроса
    ```
  curl "http://127.0.0.1:8000/equipments/search?search=Оборудование1"
  ```
Поиск всего оборудования
- Метод: GET
- URL: /equipments
- Пример запроса:
    ```
    curl "http://127.0.0.1:8000/equipments"
  ```
Обновление оборудования
- Метод: PUT
- URL: /equipments/{equipment_id}
- Тело запроса:
    ```json
    {
      "name": "Новое Оборудование", 
      "departments": [
          {"department_id": 2}, 
          {"department_id": 3}
        ]
   }
  ```
Поля name и departments не обязательны к заполнению, что позволяет частично обновить запись

Удаление оборудования
- Метод: DELETE
- URL: /equipments/{equipment_id}
- Пример запроса:
    ```
    curl -X DELETE "http://127.0.0.1:8000/equipments/1"
  ```